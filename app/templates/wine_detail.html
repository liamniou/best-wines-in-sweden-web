{% extends "base.html" %}

{% block title %}{{ wine.systembolaget_name }} - Best Wines Sweden{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item active">Wine Details</li>
        </ol>
    </nav>
    
    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-6">
            <div class="card wine-card">
                <!-- Card Header - Same as main page -->
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center gap-1">
                        <span class="badge {% if wine.vivino_rating %}bg-warning text-dark{% else %}bg-secondary{% endif %}">
                            <i class="bi bi-star-fill"></i> {{ wine.vivino_rating if wine.vivino_rating else 'N/A' }}
                        </span>
                        {% set style = wine.vivino_wine_style or wine.wine_style %}
                        {% if style %}
                        <span class="badge {% if 'red' in style|lower %}wine-style-red{% elif 'white' in style|lower %}wine-style-white{% elif 'rosÃ©' in style|lower or 'rose' in style|lower %}wine-style-rose{% elif 'sparkling' in style|lower or 'champagne' in style|lower or 'prosecco' in style|lower %}wine-style-sparkling{% elif 'dessert' in style|lower or 'sweet' in style|lower %}wine-style-dessert{% elif 'fortified' in style|lower or 'port' in style|lower or 'sherry' in style|lower %}wine-style-fortified{% else %}wine-style-other{% endif %}">{{ style }}</span>
                        {% endif %}
                        {% set country = wine.vivino_country or wine.country %}
                        {% if country %}
                        <span class="badge bg-light text-dark" title="{{ country }}">{% if 'spain' in country|lower or 'spanien' in country|lower %}ğŸ‡ªğŸ‡¸{% elif 'france' in country|lower or 'frankrike' in country|lower %}ğŸ‡«ğŸ‡·{% elif 'italy' in country|lower or 'italien' in country|lower %}ğŸ‡®ğŸ‡¹{% elif 'germany' in country|lower or 'tyskland' in country|lower %}ğŸ‡©ğŸ‡ª{% elif 'portugal' in country|lower %}ğŸ‡µğŸ‡¹{% elif 'australia' in country|lower or 'australien' in country|lower %}ğŸ‡¦ğŸ‡º{% elif 'chile' in country|lower %}ğŸ‡¨ğŸ‡±{% elif 'argentina' in country|lower %}ğŸ‡¦ğŸ‡·{% elif 'usa' in country|lower or 'united states' in country|lower %}ğŸ‡ºğŸ‡¸{% elif 'south africa' in country|lower or 'sydafrika' in country|lower %}ğŸ‡¿ğŸ‡¦{% elif 'new zealand' in country|lower or 'nya zeeland' in country|lower %}ğŸ‡³ğŸ‡¿{% elif 'austria' in country|lower or 'Ã¶sterrike' in country|lower %}ğŸ‡¦ğŸ‡¹{% elif 'greece' in country|lower or 'grekland' in country|lower %}ğŸ‡¬ğŸ‡·{% elif 'lebanon' in country|lower or 'libanon' in country|lower %}ğŸ‡±ğŸ‡§{% elif 'north macedonia' in country|lower or 'nordmakedonien' in country|lower %}ğŸ‡²ğŸ‡°{% else %}ğŸŒ{% endif %}</span>
                        {% endif %}
                    </div>
                    {% if wine.price %}
                    <span class="badge bg-dark">{{ "%.0f"|format(wine.price) }} SEK</span>
                    {% endif %}
                </div>
                
                <!-- Wine Image - Centered like main page -->
                {% if wine.image_url %}
                <div class="wine-image-container text-center py-4 bg-light">
                    <img src="{{ wine.image_url }}" 
                         alt="{{ wine.systembolaget_name }}" 
                         class="wine-bottle-image img-fluid"
                         style="max-height: 280px; max-width: 160px; object-fit: contain;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="wine-placeholder d-none text-muted">
                        <i class="bi bi-cup" style="font-size: 4rem;"></i>
                        <br><small>No image available</small>
                    </div>
                </div>
                {% else %}
                <div class="wine-image-container text-center py-4 bg-light">
                    <div class="wine-placeholder text-muted">
                        <i class="bi bi-cup" style="font-size: 4rem;"></i>
                        <br><small>No image available</small>
                    </div>
                </div>
                {% endif %}
                
                <div class="card-body">
                    <!-- Wine Title with Match Background - Same as main page -->
                    <div class="wine-title-container {% if wine.match_score >= 80 %}match-high{% elif wine.match_score >= 50 %}match-medium{% else %}match-low{% endif %} mb-4">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <p class="card-title fw-bold mb-1 fs-6">{{ wine.systembolaget_name }}</p>
                                {% if wine.vivino_name and wine.vivino_name != wine.systembolaget_name %}
                                <p class="text-muted mb-0 fst-italic fs-6">{{ wine.vivino_name }}</p>
                                {% endif %}
                            </div>
                            {% if wine.match_score %}
                            <span class="badge {% if wine.match_score >= 80 %}bg-success{% elif wine.match_score >= 50 %}bg-warning text-dark{% else %}bg-danger{% endif %} ms-2">{{ "%.0f"|format(wine.match_score) }}%</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Wine Details -->
                    <div class="wine-details mb-4">
                        <div class="row g-2">
                            {% if wine.vivino_country or wine.country %}
                            <div class="col-6">
                                <div class="d-flex align-items-center text-muted small">
                                    <i class="bi bi-geo-alt me-2"></i>
                                    <span class="fw-semibold text-dark">{{ wine.vivino_country or wine.country }}</span>
                                </div>
                            </div>
                            {% endif %}
                            {% if wine.vivino_winery or wine.producer %}
                            <div class="col-6">
                                <div class="d-flex align-items-center text-muted small">
                                    <i class="bi bi-house me-2"></i>
                                    <span class="fw-semibold text-dark">{{ wine.vivino_winery or wine.producer }}</span>
                                </div>
                            </div>
                            {% endif %}
                            {% if wine.year %}
                            <div class="col-6">
                                <div class="d-flex align-items-center text-muted small">
                                    <i class="bi bi-calendar me-2"></i>
                                    <span class="fw-semibold text-dark">{{ wine.year }}</span>
                                </div>
                            </div>
                            {% endif %}
                            {% if wine.vivino_alcohol_content or wine.alcohol_percentage %}
                            <div class="col-6">
                                <div class="d-flex align-items-center text-muted small">
                                    <i class="bi bi-percent me-2"></i>
                                    <span class="fw-semibold text-dark">{{ wine.vivino_alcohol_content or wine.alcohol_percentage }}%</span>
                                </div>
                            </div>
                            {% endif %}
                            {% if wine.vivino_num_ratings %}
                            <div class="col-6">
                                <div class="d-flex align-items-center text-muted small">
                                    <i class="bi bi-people me-2"></i>
                                    <span class="fw-semibold text-dark">{{ "{:,}".format(wine.vivino_num_ratings) }} reviews</span>
                                </div>
                            </div>
                            {% endif %}
                            {% if wine.product_number %}
                            <div class="col-6">
                                <div class="d-flex align-items-center text-muted small">
                                    <i class="bi bi-upc me-2"></i>
                                    <span class="fw-semibold text-dark">#{{ wine.product_number }}</span>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Taste Characteristics -->
                    {% if wine.body or wine.acidity or wine.sweetness or wine.tannin %}
                    <div class="mb-4">
                        <h6 class="text-muted mb-2"><i class="bi bi-palette"></i> Taste Profile</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% if wine.body %}
                            <span class="badge bg-info">{% if wine.body <= 2 %}Light{% elif wine.body <= 3 %}Medium{% else %}Full{% endif %} Body</span>
                            {% endif %}
                            {% if wine.acidity %}
                            <span class="badge bg-warning text-dark">{% if wine.acidity <= 2 %}Low{% elif wine.acidity <= 3 %}Medium{% else %}High{% endif %} Acidity</span>
                            {% endif %}
                            {% if wine.sweetness %}
                            <span class="badge bg-danger">{% if wine.sweetness <= 1 %}Bone Dry{% elif wine.sweetness <= 2 %}Dry{% elif wine.sweetness <= 3 %}Off-Dry{% elif wine.sweetness <= 4 %}Medium Sweet{% else %}Sweet{% endif %}</span>
                            {% endif %}
                            {% if wine.tannin %}
                            <span class="badge bg-secondary">{% if wine.tannin <= 2 %}Low{% elif wine.tannin <= 3 %}Medium{% else %}High{% endif %} Tannins</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Food Pairings -->
                    {% if wine.simplified_food_pairings %}
                    <div class="mb-3">
                        <h6 class="text-muted mb-2"><i class="bi bi-egg-fried"></i> Food Pairings</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for pairing in wine.simplified_food_pairings %}<span class="badge bg-light text-dark food-emoji-badge">{% if pairing|lower == 'beef' %}ğŸ¥©{% elif pairing|lower == 'pork' %}ğŸ¥“{% elif pairing|lower == 'lamb' %}ğŸ‘{% elif pairing|lower == 'game' %}ğŸ¦Œ{% elif pairing|lower in ['poultry', 'chicken'] %}ğŸ”{% elif pairing|lower == 'duck' %}ğŸ¦†{% elif pairing|lower == 'fish' %}ğŸŸ{% elif pairing|lower in ['shellfish', 'seafood'] %}ğŸ¦{% elif pairing|lower == 'cheese' %}ğŸ§€{% elif pairing|lower in ['vegetables', 'vegetarian'] %}ğŸ¥¬{% elif pairing|lower == 'pasta' %}ğŸ{% elif pairing|lower in ['dessert', 'desserts'] %}ğŸ°{% elif pairing|lower == 'chocolate' %}ğŸ«{% elif pairing|lower == 'nuts' %}ğŸ¥œ{% elif pairing|lower in ['appetizer', 'appetizers'] %}ğŸ¥‚{% else %}ğŸ½ï¸{% endif %} {{ pairing|capitalize }}</span> {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Card Footer - Same as main page -->
                <div class="card-footer bg-transparent">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="/" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-arrow-left"></i> Back
                        </a>
                        <a href="https://systembolaget.se/sortiment/vin/?q={{ wine.product_number }}" 
                           target="_blank" class="btn btn-primary btn-sm">
                            <i class="bi bi-cart"></i> Buy at Systembolaget
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
